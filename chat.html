<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Simple Chat App</title>
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background:#1a222f;
      color: #eee;
      display: flex;
      height: 100vh;
    }
    .sidebar {
      width: 250px;
      background: #1b2430;
      border-right: 1px solid #333;
      padding: 1rem;
      display: flex;
      flex-direction: column;
    }
    .sidebar h2 {
      margin: 0 0 10px;
      font-size: 1.2rem;
    }
    .room-list {
      flex: 1;
      overflow-y: auto;
      list-style: none;
      padding: 0;
      margin: 0;
    }
    .room-list li {
      padding: 10px;
      border: 1px solid #333;
      margin-bottom: 8px;
      border-radius: 6px;
      cursor: pointer;
    }
    .room-list li:hover {
      background: #2a3544;
    }
    .main {
      flex: 1;
      display: flex;
      flex-direction: column;
    }
    .chat-header {
      padding: 12px;
      border-bottom: 1px solid #333;
      background: #1a222f;
      font-weight: bold;
    }
    .messages {
      flex: 1;
      padding: 1rem;
      overflow-y: auto;
    }
    .message {
      margin-bottom: 10px;
      padding: 8px 12px;
      border-radius: 10px;
      background: #202a39;
    }
    .message .meta {
      font-size: 0.8rem;
      color: #9fb2c3;
    }
    .chat-input {
      display: flex;
      padding: 10px;
      border-top: 1px solid #333;
      background: #1a222f;
    }
    .chat-input input {
      flex: 1;
      padding: 8px;
      border: none;
      border-radius: 6px;
      margin-right: 8px;
    }
    .chat-input button {
      background: #6aa9ff;
      color: #000;
      border: none;
      border-radius: 6px;
      padding: 8px 14px;
      cursor: pointer;
    }
    .chat-input button:hover {
      filter: brightness(1.1);
    }
    /* Responsive */
    @media (max-width: 700px) {
      .sidebar { width: 180px; font-size: 0.9rem; }
    }
  </style>
</head>
<body>

  <div class="sidebar">
    <h2>Chat Rooms</h2>
    <ul class="room-list" id="roomList"></ul>
    <input type="text" id="newRoom" placeholder="New room name">
    <button onclick="createRoom()">Create Room</button>
  </div>

  <div class="main">
    <div class="chat-header" id="chatHeader">Select a Room</div>
    <div class="messages" id="messages"></div>
    <div class="chat-input">
      <input type="text" id="messageInput" placeholder="Type a message..." disabled>
      <button onclick="sendMessage()" disabled id="sendBtn">Send</button>
    </div>
  </div>

<script>
let username = prompt("Enter your username:");
if(!username) username = "Guest" + Math.floor(Math.random()*1000);

let currentRoom = null;

// Load rooms from localStorage
function loadRooms(){
  let rooms = JSON.parse(localStorage.getItem("rooms") || "[]");
  let list = document.getElementById("roomList");
  list.innerHTML = "";
  rooms.forEach(r=>{
    let li = document.createElement("li");
    li.textContent = r;
    li.onclick = ()=> joinRoom(r);
    list.appendChild(li);
  });
}

// Create new room

function createRoom(){
  let room = document.getElementById("newRoom").value.trim();
  if(room){
    let rooms = JSON.parse(localStorage.getItem("rooms") || "[]");
    if(!rooms.includes(room)){
      rooms.push(room);
      localStorage.setItem("rooms", JSON.stringify(rooms));
      loadRooms();
    }
    document.getElementById("newRoom").value = "";
  }
}

// Join room
function joinRoom(room){
  currentRoom = room;
  document.getElementById("chatHeader").textContent = "Room: " + room;
  document.getElementById("messageInput").disabled = false;
  document.getElementById("sendBtn").disabled = false;
  loadMessages();
}

// Load messages
function loadMessages(){
  if(!currentRoom) return;
  let messages = JSON.parse(localStorage.getItem("chat-"+currentRoom) || "[]");
  let msgBox = document.getElementById("messages");
  msgBox.innerHTML = "";
  messages.forEach(m=>{
    let div = document.createElement("div");
    div.className = "message";
    div.innerHTML = "<div class='meta'>${m.user} @ ${m.time}</div><div>${m.text} </div>";
    msgBox.appendChild(div);
  });
  msgBox.scrollTop = msgBox.scrollHeight;
}

// Send message
function sendMessage(){
  let input = document.getElementById("messageInput");
  let text = input.value.trim();
  if(text && currentRoom){
    let messages = JSON.parse(localStorage.getItem("chat-"+currentRoom) || "[]");
    let time = new Date().toLocaleTimeString();
    messages.push({user: username, text, time});
    localStorage.setItem("chat-"+currentRoom, JSON.stringify(messages));
    input.value = "";
    loadMessages();
  }
}

// Auto-refresh messages
setInterval(loadMessages, 1000);

// Initialize
loadRooms();
</script>
</body>
</html>